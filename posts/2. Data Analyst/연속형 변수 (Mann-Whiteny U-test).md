# Mann-Whitney U-test

## 1. Mann-Whiteny U-test가 뭔데 씹덕아.
- 검정의 흐름은, 정규분포로 근사하는 것으로 시작한다. 모분포(실제 데이터의 분포)가 멱분포이든, 정규분포이든, 지수분포이든, 균일분포이든, 포아송분포이든 등.. 검정 통계량의 분포를 정규분포로 근사하는 것으로 시작한다. 그러나, 정규분포로 근사하는 게 어려울 때가 있다. 가령, 멱분포의 경우, 꼬리가 매우 두껍다면, 중심극한정리로 우리가 알고 있는 정규분포로 근사하는 것이 어려울 수 있다. 이 경우, 우리가 알고 있는 t-statistic을 사용하여 검정하는 것이 어려울 수 있다. (t-test의 가정 중 하나인, 정규성을 만족시키지 못하기 때문이다)

- 중심극한정리를 활용하여 정규분포로 근사하는 게 어려울 때, 다양한 방법들을 활용하여, 정규분포로 근사하여야 한다. Mann-Whitney U-test는 이러한 방법 중 하나이다.

## 2. Mann-Whiteny의 컨셉
- Mann-Whiteny U-test는 두 집단의 분포가 동일한지 검정하는 방법이다. 조금 더 정확하게 얘기하면, 두 집단의 간의 서열상의 차이가 없는지를 검정하는 방법이다. 그래서 이게 뭔 말인데? Mann-Whiteny 검정의 과정을 보면, 좀 더 쉽게 이해할 수 있을 것 같다.

참고 영상 : https://youtu.be/LcxB56PzylA?si=m8gw5NYtQqPixHjb
이 영상을 보고 오면, 좀 더 이해하기 쉬울 것이다.

두 집단 간의 데이터들에 랭크를 부여 한다. A 그룹에 있는 김아무개가 값이 제일 낮네? 너 꼴등. A 그룹에 있는 이아무개가 값이 두번째로 낮네? 너 2등. 이런 식으로, 두 집단의 데이터들에 랭크를 부여한다. 그리고, 각 그룹의 랭크의 합을 구한다. 

만약, 두 집단의 분포가 동일하다면, 두 그룹의 랭크의 합은 동일할 것이다. (좀 더 엄밀하게 정의하자면, 두 집단의 서열상의 차이가 없다면, 두 그룹의 랭크의 합은 비슷할 것이다. 분포가 다르더라도, 랭크의 합이 비슷한 경우도 있다.)

## 3. U-test
각각의 랭크의 합을 구한 뒤, U-test를 수행한다. t-test와 마찬가지로 먼저, U-statistic을 구한다. 

구하는 공식은 다음과 같다. 

$U_1 = n_1 n_2 + \frac{n_1(n_1+1)}{2} - R_1$
$U_2 = n_1 n_2 + \frac{n_2(n_2+1)}{2} - R_2$

여기서, $n_1$은 첫번째 그룹의 데이터의 개수, $n_2$는 두번째 그룹의 데이터의 개수, $R_1$은 첫번째 그룹의 랭크의 합, $R_2$는 두번째 그룹의 랭크의 합이다. 

U1과 U2는 사실 동일한 정보를 담고 있다. 왜냐하면, $R_1 + R_2 = \frac{n(n+1)}{2}$이기 때문이다. 내가 너를 이긴 횟수나, 너가 나를 이긴 횟수나 결국 동일한 정보이기에, 둘 중 어느 것을 써도 결과(p-value)는 동일하다. 그러나 통상적으로는 둘 중 더 작은 값 (min(U1,U2))을 기준으로 표를 찾는다.

샘플 수가 작은 경우 (n1, n2 < 20)에는 전용표(Mann-Whitney U 검정표(Critical Values Table)를 보고 p-value를 구한다. 샘플 수가 충분한 경우 (n1, n2 >= 20)에는 정규분포로 근사하여 , Z 분포 상에서 p-value를 구한다. 데이터 개수가 많아지면, U 통계량의 분포도 정규분포에 따르게 된다는 것이 수학적으로 증명되어 있지만, 여기에서는 생략하겠다. 

구해진 U값을

## 4. 실제 예시

위의 설명이 잘 이해가 안됐다? 괜찮다. 실제 데이터를 가지고 차근차근 해보자.
