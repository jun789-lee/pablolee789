# 제3회 상관계수 (続き) 와 이변량 정규분포

## 1. 복습: 상관계수 r의 성질

### 상관계수 공식 (기술통계)
$$r_{XY} = \frac{\sum_{i=1}^{N}(X_i - \bar{X})(Y_i - \bar{Y})}{\sqrt{\sum(X_i - \bar{X})^2} \cdot \sqrt{\sum(Y_i - \bar{Y})^2}}$$

### |r| = 1 일 때의 의미
- **r = 1**: 모든 점 $(X_i, Y_i)$가 **기울기 양수인 직선** 위에 있음
- **r = -1**: 모든 점이 **기울기 음수인 직선** 위에 있음

### 직선의 방정식
$$Y_i = t \cdot X_i + (\bar{Y} - t\bar{X})$$

여기서:
- t = 기울기 (slope)
- $\bar{Y} - t\bar{X}$ = y절편 (intercept)

---

## 2. 기술통계 → 추측통계로의 전환

### 지금까지 (제2회)
> 데이터 = 숫자 그 자체 (기술통계)

### 이제부터 (제3회~)
> 데이터 = **확률벡터의 실현값** (추측통계)

### 확률벡터란?
$$\mathbf{X} = (X, Y)$$

두 확률변수 X와 Y를 묶어서 하나의 **벡터**로 본 것

---

## 3. 이변량 정규분포 (Bivariate Normal Distribution)

### 설정
$$X \sim N(\mu_X, \sigma_X^2)$$
$$Y \sim N(\mu_Y, \sigma_Y^2)$$

| 모수 | 의미 |
|---|---|
| $\mu_X, \mu_Y$ | 각각의 기대값 (모평균) |
| $\sigma_X^2, \sigma_Y^2$ | 각각의 분산 (모분산) |
| $\rho$ | **모상관계수** |

### 예시: 50대 남성의 혈압
- X = 수축기 혈압 (上)
- Y = 이완기 혈압 (下)
- 무작위 추출 (Random Sample)로 N명의 데이터 수집
- $(X_1, Y_1), (X_2, Y_2), \ldots, (X_N, Y_N)$: 이변량 정규분포에서 온 실현값

---

## 4. 이변량 정규분포의 동시밀도함수 (Joint PDF)

$$f(x,y) = \frac{1}{2\pi\sigma_X\sigma_Y\sqrt{1-\rho^2}} \exp\left(-\frac{1}{2(1-\rho^2)}Q\right)$$

여기서 Q는:
$$Q = \left(\frac{x-\mu_X}{\sigma_X}\right)^2 - 2\rho\left(\frac{x-\mu_X}{\sigma_X}\right)\left(\frac{y-\mu_Y}{\sigma_Y}\right) + \left(\frac{y-\mu_Y}{\sigma_Y}\right)^2$$

### Z-변환 사용
$$Z_X = \frac{X - \mu_X}{\sigma_X}, \quad Z_Y = \frac{Y - \mu_Y}{\sigma_Y}$$

로 두면:
$$Q = Z_X^2 - 2\rho Z_X Z_Y + Z_Y^2$$

---

## 5. 평방완성 (Completing the Square)

### 목표: Q를 분해하여 조건부 밀도 유도

$$Q = Z_X^2 - 2\rho Z_X Z_Y + Z_Y^2$$

평방완성을 하면:
$$Q = (Z_Y - \rho Z_X)^2 + (1 - \rho^2)Z_X^2$$

### 동시밀도함수를 다시 쓰면:
$$f(x,y) = \underbrace{\frac{1}{\sqrt{2\pi}\sigma_X}e^{-\frac{Z_X^2}{2}}}_{X\text{의 주변밀도 } f_X(x)} \times \underbrace{\frac{1}{\sqrt{2\pi}\sigma_Y\sqrt{1-\rho^2}}e^{-\frac{(Z_Y - \rho Z_X)^2}{2(1-\rho^2)}}}_{Y|X\text{의 조건부밀도 } f_{Y|X}(y|x)}$$

---

## 6. 조건부 분포 (Conditional Distribution)

### Y | X = x 의 분포

$$Y | X = x \sim N\left(\mu_Y + \rho\frac{\sigma_Y}{\sigma_X}(x - \mu_X), \quad \sigma_Y^2(1 - \rho^2)\right)$$

| 모수 | 공식 | 의미 |
|---|---|---|
| 조건부 평균 | $\mu_Y + \rho\frac{\sigma_Y}{\sigma_X}(x - \mu_X)$ | X가 주어지면 Y의 기대값이 변함 |
| 조건부 분산 | $\sigma_Y^2(1 - \rho^2)$ | X를 알면 Y의 불확실성 감소 |

### 해석
- $\rho = 0$: 조건부 평균 = $\mu_Y$ (X와 무관)
- $|\rho| = 1$: 조건부 분산 = 0 (X를 알면 Y가 완전 결정)

---

## 7. 곱셈공식 (Multiplication Rule)

### 확률에서
$$P(A \cap B) = P(A) \cdot P(B|A)$$

### 밀도함수에서
$$f_{X,Y}(x,y) = f_X(x) \cdot f_{Y|X}(y|x)$$

| 용어 | 의미 |
|---|---|
| $f_{X,Y}(x,y)$ | 동시(결합) 밀도함수 (joint density) |
| $f_X(x)$ | X의 주변밀도함수 (marginal density) |
| $f_{Y|X}(y|x)$ | 조건부 밀도함수 (conditional density) |

---

## 8. 중적분 (Double Integral) 맛보기

### 동시 확률 계산
$$P(a \leq X \leq b, c \leq Y \leq d) = \int_a^b \int_c^d f(x,y) \, dy \, dx$$

### 누적적분 (Iterated Integral)
$$= \int_a^b \left( \int_c^d f(x,y) \, dy \right) dx$$

### 기하학적 의미
- xy평면 위의 직사각형 $[a,b] \times [c,d]$
- 곡면 z = f(x,y) 아래의 **부피**

---

## 9. 핵심 공식 정리

| 개념 | 공식 |
|---|---|
| Z-변환 | $Z_X = \frac{X - \mu_X}{\sigma_X}$ |
| 동시밀도 분해 | $f_{X,Y}(x,y) = f_X(x) \cdot f_{Y\|X}(y\|x)$ |
| 조건부 평균 | $E[Y\|X=x] = \mu_Y + \rho\frac{\sigma_Y}{\sigma_X}(x - \mu_X)$ |
| 조건부 분산 | $\text{Var}(Y\|X=x) = \sigma_Y^2(1 - \rho^2)$ |

---

## 10. 이 강의의 핵심 메시지

1. **기술통계 → 추측통계 전환**
   - 표본상관계수 r은 모상관계수 ρ의 추정량

2. **이변량 정규분포 도입**
   - 두 변수를 함께 다루는 확률 모델

3. **조건부 분포**
   - X를 알면 Y에 대한 정보가 업데이트됨
   - 이것이 회귀분석의 기초!

---

## 11. Q&A: 자주 헷갈리는 개념

### Q. 동시밀도함수와 주변밀도함수의 관계?

**주변밀도 = 동시밀도를 다른 변수에 대해 적분**

$$f_X(x) = \int_{-\infty}^{\infty} f_{X,Y}(x,y) \, dy$$

$$f_Y(y) = \int_{-\infty}^{\infty} f_{X,Y}(x,y) \, dx$$

### Q. 조건부밀도는 어떻게 구하나?

$$f_{Y|X}(y|x) = \frac{f_{X,Y}(x,y)}{f_X(x)}$$

> 확률에서 $P(B|A) = \frac{P(A \cap B)}{P(A)}$ 와 같은 구조!

---

## 12. 다음 강의 예고

> **제4회**: 이산형 동시확률함수, 포아송 분포 예제

연속형(정규분포)에서 이산형으로 확장하여 같은 개념들을 다시 연습합니다.

---

## 13. 심화: Z-변환 → 조건부분포 도출의 전체 흐름

### 🎯 목표
> 동시밀도함수 $f(x,y)$에서 조건부분포 $f_{Y|X}(y|x)$를 **유도**하고 싶다

### 왜 Z-변환을 하는가?

**원래 동시밀도함수 (복잡함!):**
$$f(x,y) = \frac{1}{2\pi\sigma_X\sigma_Y\sqrt{1-\rho^2}} \exp\left(-\frac{\text{복잡한 식}}{2(1-\rho^2)}\right)$$

**Z-변환 후 (단순해짐!):**

$Z_X = \frac{x-\mu_X}{\sigma_X}$, $Z_Y = \frac{y-\mu_Y}{\sigma_Y}$ 로 치환하면:

$$\text{exp 안의 복잡한 식} = Z_X^2 - 2\rho Z_X Z_Y + Z_Y^2$$

> **Z-변환 이유**: $\mu$와 $\sigma$가 사라져서 계산이 간단해지고, **ρ의 역할**이 명확히 보임

---

### Step by Step 흐름

**Step 1: 평방완성 (Y에 대해 정리)**

$$Z_X^2 - 2\rho Z_X Z_Y + Z_Y^2 = (Z_Y - \rho Z_X)^2 + (1-\rho^2)Z_X^2$$

- 첫 번째 항 $(Z_Y - \rho Z_X)^2$: **Y에 관련된 부분**
- 두 번째 항 $(1-\rho^2)Z_X^2$: **X에만 관련된 부분**

**Step 2: exp에 넣고 분리**

$$f(x,y) = \underbrace{(\text{X에 관한 부분})}_{f_X(x)} \times \underbrace{(\text{Y-ρX에 관한 부분})}_{f_{Y|X}(y|x)}$$

**Step 3: 조건부분포 도출**

$$Y | X=x \sim N\left(\mu_Y + \rho\frac{\sigma_Y}{\sigma_X}(x-\mu_X), \quad \sigma_Y^2(1-\rho^2)\right)$$

---

### 전체 흐름도

```
[동시밀도 f(x,y)]
      ↓ Z-변환 (계산 단순화)
[지수 안: Z_X² - 2ρZ_XZ_Y + Z_Y²]
      ↓ 평방완성 (Y에 대해 정리)
[(Z_Y - ρZ_X)² + (1-ρ²)Z_X²]
      ↓ exp에 넣고 분리
[f_X(x) × f_{Y|X}(y|x)]
      ↓
[조건부분포 도출 완료!]
```

---

### 왜 이게 중요한가?

조건부 평균:
$$E[Y|X=x] = \mu_Y + \rho\frac{\sigma_Y}{\sigma_X}(x-\mu_X)$$

> "X를 알면 Y의 예측값이 변한다" → 이것이 **회귀분석**의 기초!

---

### Q. 왜 앞부분이 주변밀도, 뒷부분이 조건부밀도인가?

**정규분포 밀도함수의 표준 형태:**
$$f(x) = \frac{1}{\sqrt{2\pi}\sigma} \exp\left(-\frac{(x-\mu)^2}{2\sigma^2}\right)$$

**패턴:**
```
        1                        (x - 평균)²
─────────────────── × exp( - ─────────────────── )
√(2π) × 표준편차                  2 × 분산
```

---

**앞부분 확인: X의 주변밀도**

$$\frac{1}{\sqrt{2\pi}\sigma_X} \exp\left(-\frac{(x-\mu_X)^2}{2\sigma_X^2}\right)$$

→ 평균 $\mu_X$, 분산 $\sigma_X^2$인 **N(μ_X, σ_X²)** 형태! ✅

---

**뒷부분 확인: Y|X의 조건부밀도**

$$\frac{1}{\sqrt{2\pi}\sigma_Y\sqrt{1-\rho^2}} \exp\left(-\frac{(Z_Y - \rho Z_X)^2}{2(1-\rho^2)}\right)$$

패턴 매칭:
- 표준편차 = $\sigma_Y\sqrt{1-\rho^2}$
- 분산 = $\sigma_Y^2(1-\rho^2)$
- 평균 = $\mu_Y + \rho\frac{\sigma_Y}{\sigma_X}(x-\mu_X)$

→ 이것도 **정규분포 형태**! ✅

---

> **핵심**: 분해된 각 부분이 정규분포 밀도함수의 **표준 형태와 일치**하는지 패턴 매칭

---

### Q. 조건부 평균은 어떻게 유도하나?

**정규분포 표준 형태의 핵심:**
$$\exp\left(-\frac{(y - \mu)^2}{2\sigma^2}\right)$$

> exp 안에서 **(y - μ)²** 형태면, **μ가 평균**

**조건부밀도의 exp 안:**
$$\exp\left(-\frac{(Z_Y - \rho Z_X)^2}{2(1-\rho^2)}\right)$$

**Step 1: Z를 원래 변수로 치환**

$Z_Y = \frac{y - \mu_Y}{\sigma_Y}$ 대입:

$$Z_Y - \rho Z_X = \frac{y - \mu_Y}{\sigma_Y} - \rho \cdot \frac{x - \mu_X}{\sigma_X}$$

**Step 2: (y - 평균) 형태로 정리**

양변에 $\sigma_Y$ 곱하면:

$$\sigma_Y(Z_Y - \rho Z_X) = y - \mu_Y - \rho\frac{\sigma_Y}{\sigma_X}(x - \mu_X)$$

$$= y - \underbrace{\left(\mu_Y + \rho\frac{\sigma_Y}{\sigma_X}(x - \mu_X)\right)}_{\text{이게 조건부 평균!}}$$

**결론:**
$$E[Y|X=x] = \mu_Y + \rho\frac{\sigma_Y}{\sigma_X}(x - \mu_X)$$

---

### 조건부 평균의 직관적 해석

| 상황 | 조건부 평균 |
|---|---|
| x = μ_X (X가 평균) | E[Y\|X] = μ_Y (Y도 평균) |
| x > μ_X, ρ > 0 | E[Y\|X] > μ_Y (X 크면 Y도 큼) |
| ρ = 0 (무상관) | E[Y\|X] = μ_Y (X와 무관) |

> **왜 이게 "조건부 평균"인가?**
> 정규분포 밀도함수에서 **μ 자리에 있는 값 = 그 분포의 평균**이므로,
> 조건부밀도의 μ 자리에 있는 값이 곧 **조건부 평균** E[Y|X=x]
