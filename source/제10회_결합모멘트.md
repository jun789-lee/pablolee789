# 제10회 결합모멘트 (Joint Moments)

## 1. 복습: 다변량 정규분포와 MGF

### 다변량 중심극럽정리 개요
$$\mathbf{Z}_n = \begin{pmatrix} Z_1 \\ Z_2 \end{pmatrix}$$

$Z_1 \sim N(0,1)$, $Z_2 \sim N(0,1)$일 때, 다변량에서도 동일한 논리가 적용됨.

### MGF 복습
$$E[e^{t_1 Z_1 + t_2 Z_2}] = E[e^{t_1 Z_1}] \cdot E[e^{t_2 Z_2}] = e^{\frac{t_1^2}{2}} \cdot e^{\frac{t_2^2}{2}}$$

(독립이므로 기댓값 분리 가능)

---

## 2. 선형변환: Z에서 X로

### 설정
- $A$: 비특이(non-singular) 행렬
- $\boldsymbol{\mu} = (\mu_1, \mu_2)^T$: 평균 벡터

### 변환
$$\mathbf{X} = A\mathbf{Z} + \boldsymbol{\mu}$$

### 역변환
$$\mathbf{Z} = B(\mathbf{X} - \boldsymbol{\mu}), \quad B = A^{-1}$$

풀어쓰면:
$$Z_1 = b_{11}(X_1 - \mu_1) + b_{12}(X_2 - \mu_2)$$
$$Z_2 = b_{21}(X_1 - \mu_1) + b_{22}(X_2 - \mu_2)$$

---

## 3. 야코비안과 밀도함수

### 야코비안
$$|J| = |B| = |A^{-1}| = \frac{1}{|A|}$$

### 공분산 행렬
$$\boldsymbol{\Sigma} = AA^T$$

### 밀도함수
$$f_X(\mathbf{x}) = \frac{1}{2\pi |\boldsymbol{\Sigma}|^{1/2}} \exp\left(-\frac{1}{2}(\mathbf{x}-\boldsymbol{\mu})^T \boldsymbol{\Sigma}^{-1} (\mathbf{x}-\boldsymbol{\mu})\right)$$

> $\mathbf{X} \sim N(\boldsymbol{\mu}, \boldsymbol{\Sigma})$, $\boldsymbol{\Sigma}$는 양정치 행렬 (positive definite matrix)

---

## 4. 양정치 행렬 (Positive Definite)

### 정의
$$\mathbf{a}^T \boldsymbol{\Sigma} \mathbf{a} > 0 \quad \text{for all } \mathbf{a} \neq \mathbf{0}$$

### 성질
- $\boldsymbol{\Sigma} = AA^T$ 형태로 분해 가능
- $A$가 비특이 ⟺ $\boldsymbol{\Sigma}$가 양정치

### 증명
$$\mathbf{a}^T AA^T \mathbf{a} = (A^T \mathbf{a})^T (A^T \mathbf{a}) = \|A^T \mathbf{a}\|^2 \geq 0$$

> 참고: $A$는 일반적으로 유일하지 않음 (Cholesky 분해 등)

---

## 5. 다변량 MGF

### 정의
$$M_{\mathbf{X}}(\mathbf{t}) = E[e^{\mathbf{t}^T \mathbf{X}}]$$

여기서 $\mathbf{t} = (t_1, t_2)^T$

### 유도
$$M_{\mathbf{X}}(\mathbf{t}) = E[e^{\mathbf{t}^T (A\mathbf{Z} + \boldsymbol{\mu})}]$$
$$= e^{\mathbf{t}^T \boldsymbol{\mu}} E[e^{\mathbf{t}^T A \mathbf{Z}}]$$

**$E[e^{\mathbf{t}^T A \mathbf{Z}}]$는 어떻게 변환되는가?**

**Step 1:** $\mathbf{s} = A^T \mathbf{t}$로 정의하면
$$\mathbf{t}^T A \mathbf{Z} = \mathbf{s}^T \mathbf{Z} = s_1 Z_1 + s_2 Z_2$$

**Step 2:** $Z_1, Z_2$가 **독립**이므로 기댓값 분리
$$E[e^{s_1 Z_1 + s_2 Z_2}] = E[e^{s_1 Z_1}] \cdot E[e^{s_2 Z_2}]$$

**Step 3:** 각각 표준정규분포의 MGF 적용
$$= e^{\frac{s_1^2}{2}} \cdot e^{\frac{s_2^2}{2}} = e^{\frac{s_1^2 + s_2^2}{2}} = e^{\frac{1}{2}\mathbf{s}^T \mathbf{s}}$$

**Step 4:** $\mathbf{s} = A^T \mathbf{t}$를 다시 대입
$$\mathbf{s}^T \mathbf{s} = (A^T \mathbf{t})^T (A^T \mathbf{t}) = \mathbf{t}^T A A^T \mathbf{t}$$

**결과:**
$$E[e^{\mathbf{t}^T A \mathbf{Z}}] = e^{\frac{1}{2}\mathbf{t}^T AA^T \mathbf{t}}$$

> **핵심:** 독립 표준정규의 MGF $e^{t^2/2}$를 활용!

### 결론
$$M_{\mathbf{X}}(\mathbf{t}) = \exp\left(\mathbf{t}^T \boldsymbol{\mu} + \frac{1}{2}\mathbf{t}^T \boldsymbol{\Sigma} \mathbf{t}\right)$$

### 일변량 vs 다변량 MGF 비교

| | 일변량 표준정규 | 일변량 일반정규 | 다변량 정규 |
|---|----------------|----------------|-------------|
| **분포** | $Z \sim N(0, 1)$ | $X \sim N(\mu, \sigma^2)$ | $\mathbf{X} \sim N(\boldsymbol{\mu}, \boldsymbol{\Sigma})$ |
| **MGF** | $e^{\frac{t^2}{2}}$ | $e^{\mu t + \frac{\sigma^2 t^2}{2}}$ | $e^{\mathbf{t}^T \boldsymbol{\mu} + \frac{1}{2}\mathbf{t}^T \boldsymbol{\Sigma} \mathbf{t}}$ |
| **$t$** | 스칼라 | 스칼라 | 벡터 |

**형태 비교:**
- 일변량: $\mu t$ (스칼라 곱), $\sigma^2 t^2$ (스칼라 곱)
- 다변량: $\mathbf{t}^T \boldsymbol{\mu}$ (내적), $\mathbf{t}^T \boldsymbol{\Sigma} \mathbf{t}$ (이차형식)

> **형태는 동일! 스칼라 연산 → 벡터/행렬 연산으로 일반화된 것!**

---

## 6. 모멘트 계산 (MGF 활용)

### n=2로 돌아가서

$$M_{\mathbf{X}}(\mathbf{t}) = M_{\mathbf{X}}(t_1, t_2) = E[e^{t_1 X_1 + t_2 X_2}]$$

### 1차 모멘트 (평균)

**$E[X_1]$ 구하기:**
$$\frac{\partial M_{\mathbf{X}}(t_1, t_2)}{\partial t_1}\bigg|_{(0,0)} = E[X_1] = \mu_1$$

**$E[X_2]$ 구하기:**
$$\frac{\partial M_{\mathbf{X}}(t_1, t_2)}{\partial t_2}\bigg|_{(0,0)} = E[X_2] = \mu_2$$

### 2차 모멘트

**$E[X_1^2]$ 구하기:**
$$\frac{\partial^2 M_{\mathbf{X}}}{\partial t_1^2}\bigg|_{(0,0)} = E[X_1^2]$$

**$E[X_2^2]$ 구하기:**
$$\frac{\partial^2 M_{\mathbf{X}}}{\partial t_2^2}\bigg|_{(0,0)} = E[X_2^2]$$

---

## 7. 결합 모멘트 (Joint Moments) ⭐

### 정의

$(k, l)$차 결합 모멘트:

$$E[X_1^k X_2^l]$$

### MGF로 구하기
$$\frac{\partial^{k+l} M_{\mathbf{X}}(t_1, t_2)}{\partial t_1^k \partial t_2^l}\bigg|_{(0,0)} = E[X_1^k X_2^l]$$

### 왜 중요한가?
$$E[X_1 X_2] = \iint x_1 x_2 f(x_1, x_2) \, dx_1 dx_2$$

**직접 적분은 어려움!** → MGF 미분으로 쉽게 계산

---

## 8. 공분산 (Covariance)

### 정의
$$\text{Cov}(X_1, X_2) = E[(X_1 - \mu_1)(X_2 - \mu_2)]$$

### 전개
$$\text{Cov}(X_1, X_2) = E[X_1 X_2 - \mu_1 X_2 - X_1 \mu_2 + \mu_1 \mu_2]$$
$$= E[X_1 X_2] - \mu_1 E[X_2] - \mu_2 E[X_1] + \mu_1 \mu_2$$
$$= E[X_1 X_2] - \mu_1 \mu_2$$

### 중요 공식 ⭐
$$\text{Cov}(X_1, X_2) = E[X_1 X_2] - \mu_1 \mu_2 = \sigma_{12}$$

> **분산 공식과 유사:** $\text{Var}(X_1) = E[X_1^2] - \mu_1^2 = \sigma_{11}$

---

## 9. 공분산 행렬의 구조

### 2변량의 경우
$$\boldsymbol{\Sigma} = \begin{pmatrix} \sigma_{11} & \sigma_{12} \\ \sigma_{21} & \sigma_{22} \end{pmatrix} = \begin{pmatrix} \text{Var}(X_1) & \text{Cov}(X_1, X_2) \\ \text{Cov}(X_2, X_1) & \text{Var}(X_2) \end{pmatrix}$$

### n변량의 경우
$$\boldsymbol{\Sigma} = \begin{pmatrix} \sigma_{11} & \sigma_{12} & \cdots & \sigma_{1n} \\ \sigma_{21} & \sigma_{22} & \cdots & \sigma_{2n} \\ \vdots & \vdots & \ddots & \vdots \\ \sigma_{n1} & \sigma_{n2} & \cdots & \sigma_{nn} \end{pmatrix}$$

---

## 10. 이차형식 (Quadratic Form)

### 정의
$$\mathbf{a}^T \boldsymbol{\Sigma} \mathbf{a} = \sum_{i=1}^{n} \sum_{j=1}^{n} \sigma_{ij} a_i a_j$$

### 전개 (n=2 예시)
$$\mathbf{a}^T \boldsymbol{\Sigma} \mathbf{a} = (a_1, a_2) \begin{pmatrix} \sigma_{11} & \sigma_{12} \\ \sigma_{21} & \sigma_{22} \end{pmatrix} \begin{pmatrix} a_1 \\ a_2 \end{pmatrix}$$
$$= \sigma_{11} a_1^2 + \sigma_{12} a_1 a_2 + \sigma_{21} a_2 a_1 + \sigma_{22} a_2^2$$
$$= \sigma_{11} a_1^2 + 2\sigma_{12} a_1 a_2 + \sigma_{22} a_2^2$$

($\sigma_{12} = \sigma_{21}$ 대칭성 이용)

---

## 11. MGF로 모멘트 계산 예시

### 설정
$$\mathbf{X} \sim N(\boldsymbol{\mu}, \boldsymbol{\Sigma}), \quad \boldsymbol{\mu} = \begin{pmatrix} \mu_1 \\ \mu_2 \end{pmatrix}, \quad \boldsymbol{\Sigma} = \begin{pmatrix} \sigma_{11} & \sigma_{12} \\ \sigma_{12} & \sigma_{22} \end{pmatrix}$$

### MGF
$$M_{\mathbf{X}}(t_1, t_2) = \exp\left(\mu_1 t_1 + \mu_2 t_2 + \frac{1}{2}(\sigma_{11} t_1^2 + 2\sigma_{12} t_1 t_2 + \sigma_{22} t_2^2)\right)$$

### 유도: 벡터 표기 → 스칼라 표기

**벡터 표기의 MGF:**
$$M_{\mathbf{X}}(\mathbf{t}) = \exp\left(\mathbf{t}^T \boldsymbol{\mu} + \frac{1}{2}\mathbf{t}^T \boldsymbol{\Sigma} \mathbf{t}\right)$$

**Step 1: $\mathbf{t}^T \boldsymbol{\mu}$ 전개**
$$\mathbf{t}^T \boldsymbol{\mu} = (t_1, t_2) \begin{pmatrix} \mu_1 \\ \mu_2 \end{pmatrix} = t_1 \mu_1 + t_2 \mu_2 = \mu_1 t_1 + \mu_2 t_2$$

**Step 2: $\mathbf{t}^T \boldsymbol{\Sigma} \mathbf{t}$ 전개 (이차형식)**

$$\mathbf{t}^T \boldsymbol{\Sigma} \mathbf{t} = (t_1, t_2) \begin{pmatrix} \sigma_{11} & \sigma_{12} \\ \sigma_{12} & \sigma_{22} \end{pmatrix} \begin{pmatrix} t_1 \\ t_2 \end{pmatrix}$$

먼저 $\boldsymbol{\Sigma} \mathbf{t}$ 계산:
$$\begin{pmatrix} \sigma_{11} & \sigma_{12} \\ \sigma_{12} & \sigma_{22} \end{pmatrix} \begin{pmatrix} t_1 \\ t_2 \end{pmatrix} = \begin{pmatrix} \sigma_{11} t_1 + \sigma_{12} t_2 \\ \sigma_{12} t_1 + \sigma_{22} t_2 \end{pmatrix}$$

그 다음 $\mathbf{t}^T$와 곱:
$$= t_1(\sigma_{11} t_1 + \sigma_{12} t_2) + t_2(\sigma_{12} t_1 + \sigma_{22} t_2)$$
$$= \sigma_{11} t_1^2 + \sigma_{12} t_1 t_2 + \sigma_{12} t_1 t_2 + \sigma_{22} t_2^2$$
$$= \sigma_{11} t_1^2 + 2\sigma_{12} t_1 t_2 + \sigma_{22} t_2^2$$

**Step 3: 최종 결과**
$$M_{\mathbf{X}}(t_1, t_2) = \exp\left(\mu_1 t_1 + \mu_2 t_2 + \frac{1}{2}(\sigma_{11} t_1^2 + 2\sigma_{12} t_1 t_2 + \sigma_{22} t_2^2)\right)$$

### 1차 편미분 ($E[X_1]$ 계산)
$$\frac{\partial M_{\mathbf{X}}}{\partial t_1} = (\mu_1 + \sigma_{11} t_1 + \sigma_{12} t_2) \cdot M_{\mathbf{X}}(t_1, t_2)$$

$(0, 0)$에서 평가:
$$\frac{\partial M_{\mathbf{X}}}{\partial t_1}\bigg|_{(0,0)} = \mu_1 \cdot 1 = \mu_1 = E[X_1]$$

### 2차 편미분 ($E[X_1^2]$ 계산)
$$\frac{\partial^2 M_{\mathbf{X}}}{\partial t_1^2}\bigg|_{(0,0)} = \sigma_{11} + \mu_1^2 = E[X_1^2]$$

따라서:
$$\text{Var}(X_1) = E[X_1^2] - \mu_1^2 = \sigma_{11}$$

### 교차 편미분 ($E[X_1 X_2]$ 계산) - 상세 유도

**Step 1: $t_1$으로 1차 편미분**

MGF: $M = e^{\mu_1 t_1 + \mu_2 t_2 + \frac{1}{2}(\sigma_{11} t_1^2 + 2\sigma_{12} t_1 t_2 + \sigma_{22} t_2^2)}$

지수 부분을 $t_1$으로 미분: $\mu_1 + \sigma_{11} t_1 + \sigma_{12} t_2$

$$\frac{\partial M}{\partial t_1} = (\mu_1 + \sigma_{11} t_1 + \sigma_{12} t_2) \cdot M$$

**Step 2: $t_2$로 2차 편미분 (곱의 미분법 적용)**

$$\frac{\partial^2 M}{\partial t_1 \partial t_2} = \frac{\partial}{\partial t_2}\left[(\mu_1 + \sigma_{11} t_1 + \sigma_{12} t_2) \cdot M\right]$$

곱의 미분법: $(fg)' = f'g + fg'$

- $f = \mu_1 + \sigma_{11} t_1 + \sigma_{12} t_2$ → $\frac{\partial f}{\partial t_2} = \sigma_{12}$
- $g = M$ → $\frac{\partial g}{\partial t_2} = (\mu_2 + \sigma_{12} t_1 + \sigma_{22} t_2) \cdot M$

따라서:
$$= \sigma_{12} \cdot M + (\mu_1 + \sigma_{11} t_1 + \sigma_{12} t_2)(\mu_2 + \sigma_{12} t_1 + \sigma_{22} t_2) \cdot M$$

**Step 3: $(0, 0)$에서 평가**

$(0, 0)$에서: $M = 1$, 그리고 $t_1 = t_2 = 0$ 대입

$$\frac{\partial^2 M}{\partial t_1 \partial t_2}\bigg|_{(0,0)} = \sigma_{12} \cdot 1 + (\mu_1)(\mu_2) \cdot 1 = \sigma_{12} + \mu_1 \mu_2$$

**결과:**
$$\frac{\partial^2 M_{\mathbf{X}}}{\partial t_1 \partial t_2}\bigg|_{(0,0)} = \sigma_{12} + \mu_1 \mu_2 = E[X_1 X_2]$$

따라서:
$$\text{Cov}(X_1, X_2) = E[X_1 X_2] - \mu_1 \mu_2 = \sigma_{12}$$

---

## 12. 핵심 공식 정리

| 개념 | 공식 |
|------|------|
| 결합 모멘트 | $E[X_1^k X_2^l] = \frac{\partial^{k+l} M_{\mathbf{X}}}{\partial t_1^k \partial t_2^l}\big\|_{(0,0)}$ |
| 공분산 | $\text{Cov}(X_1, X_2) = E[X_1 X_2] - \mu_1 \mu_2 = \sigma_{12}$ |
| 분산 | $\text{Var}(X_i) = E[X_i^2] - \mu_i^2 = \sigma_{ii}$ |
| 이차형식 | $\mathbf{a}^T \boldsymbol{\Sigma} \mathbf{a} = \sum_i \sum_j \sigma_{ij} a_i a_j$ |

---

## 13. 이 강의의 핵심 메시지

1. **결합 모멘트의 정의**
   - $E[X_1^k X_2^l]$: 여러 변수의 곱의 기댓값

2. **MGF로 결합 모멘트 계산**
   - 직접 적분보다 **편미분**이 쉬움!

3. **공분산과 결합 모멘트의 관계**
   - $\text{Cov}(X_1, X_2) = E[X_1 X_2] - \mu_1 \mu_2$

4. **이차형식의 이해**
   - 공분산 행렬을 이용한 스칼라 계산

5. **다음 단계**
   - 조건부 분포와 주변 분포
   - 다변량 중심극한정리

---

## 14. Q&A

### Q1. 왜 직접 적분 대신 MGF를 쓰는가?

$$E[X_1 X_2] = \iint x_1 x_2 f(x_1, x_2) \, dx_1 dx_2$$

이변량 정규분포의 밀도함수를 넣으면 **매우 복잡한 적분**이 됨!

MGF 미분은 지수함수 미분이므로 **계산이 깔끔**함.

### Q2. $\sigma_{12}$와 상관계수 $\rho$의 관계는?

$$\rho = \frac{\sigma_{12}}{\sigma_1 \sigma_2} = \frac{\text{Cov}(X_1, X_2)}{\sqrt{\text{Var}(X_1)} \cdot \sqrt{\text{Var}(X_2)}}$$

따라서:
$$\sigma_{12} = \rho \sigma_1 \sigma_2$$

### Q3. 이차형식이 왜 중요한가?

밀도함수의 지수 부분이 이차형식:
$$(\mathbf{x}-\boldsymbol{\mu})^T \boldsymbol{\Sigma}^{-1} (\mathbf{x}-\boldsymbol{\mu})$$

이차형식의 성질을 알면 밀도함수 분석이 쉬워짐!
