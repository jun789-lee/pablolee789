# 제5회 이산확률변수의 공분산 · 중적분 (1)

## 1. 복습: 기념품 가게 예제

### 설정
- Z ~ Poisson(λ): 총 방문 고객 수 (기대 방문객 = λ)
- X: 구매한 고객 수, Y: 구매하지 않은 고객 수
- Z = X + Y
- 구매 확률: p

### 조건부 분포
$$X | Z=z \sim \text{Binomial}(z, p)$$

### 주변분포 (X의 분포)
$$X \sim \text{Poisson}(p\lambda)$$
$$Y \sim \text{Poisson}((1-p)\lambda)$$

> 놀라운 사실: X와 Y는 **독립**!

---

## 2. 곱셈공식 (Multiplication Rule)

### 두 가지 방향

**방향 1: Z 먼저**
$$P(X=x, Z=z) = P(Z=z) \cdot P(X=x|Z=z)$$

**방향 2: X 먼저 (베이즈적 사고)**
$$P(X=x, Z=z) = P(X=x) \cdot P(Z=z|X=x)$$

---

## 3. 반복기대값 공식 복습

### 핵심 공식
$$E[E[X|Z]] = E[X]$$

### 일반화: 함수 g(X,Z)에 대해
$$E[g(X,Z)] = E[E[g(X,Z)|Z]]$$

**왜 성립하나?**

g(X,Z)도 결국 **확률변수**이기 때문!

| g(X,Z) 예시 | 의미 |
|---|---|
| X | 그냥 X |
| XZ | X와 Z의 곱 |
| X² | X의 제곱 |

> **핵심**: g(X,Z)가 어떤 함수든, "조건부 기대값의 기대값 = 무조건부 기대값"

---

## 4. 결합(동시) 모멘트 계산

### 정의
$$E[g(X,Z)] = \sum_{x,z} g(x,z) \cdot P(X=x, Z=z)$$

### 예제: g(X,Z) = XZ (곱)

반복기대값을 사용:
$$E[XZ] = E[E[XZ|Z]]$$

**Step 1: 조건부 기대값 계산**

Z=z가 주어지면 Z는 상수:
$$E[XZ|Z=z] = E[Xz|Z=z] = z \cdot E[X|Z=z]$$

**E[X|Z=z] = zp 가 되는 이유:**

X|Z=z의 분포를 기억하면:
$$X | Z=z \sim \text{Binomial}(z, p)$$

이항분포의 기대값: $E[\text{Binomial}(n,p)] = np$

따라서:
$$E[X|Z=z] = z \cdot p = zp$$

> "z명 중 각자가 확률 p로 구매 → 평균 zp명 구매"

**최종:**
$$E[XZ|Z=z] = z \cdot zp = z^2 p$$

**Step 2: 확률변수로 표현**
$$E[XZ|Z] = Z^2 p$$

**Step 3: 기대값 계산**
$$E[XZ] = E[Z^2 p] = p \cdot E[Z^2]$$

**Step 4: E[Z²] 계산**

포아송의 경우: $E[Z] = \lambda$, $\text{Var}(Z) = \lambda$

분산 공식: $\text{Var}(Z) = E[Z^2] - (E[Z])^2$

따라서: $E[Z^2] = \text{Var}(Z) + (E[Z])^2 = \lambda + \lambda^2$

**결론:**
$$E[XZ] = p(\lambda^2 + \lambda)$$

---

## 5. 공분산 (Covariance)

### 정의
$$\text{Cov}(X,Z) = E[(X-\mu_X)(Z-\mu_Z)]$$

### 공분산 공식 (계산에 편리)
$$\text{Cov}(X,Z) = E[XZ] - \mu_X \mu_Z$$

### 공식 유도
$$E[(X-\mu_X)(Z-\mu_Z)] = E[XZ - \mu_X Z - X\mu_Z + \mu_X\mu_Z]$$
$$= E[XZ] - \mu_X E[Z] - \mu_Z E[X] + \mu_X\mu_Z$$
$$= E[XZ] - \mu_X\mu_Z$$

### 예제에서 공분산 계산
- $\mu_X = E[X] = p\lambda$
- $\mu_Z = E[Z] = \lambda$
- $E[XZ] = p(\lambda^2 + \lambda)$

$$\text{Cov}(X,Z) = p(\lambda^2 + \lambda) - p\lambda \cdot \lambda = p\lambda^2 + p\lambda - p\lambda^2 = p\lambda$$

---

## 6. 분산 공식 (참고)

$$\text{Var}(X) = E[(X-\mu_X)^2] = E[X^2] - \mu_X^2$$

> 공분산 공식에서 Z = X로 두면 분산 공식이 됨

---

## 7. 중적분 (Double Integral) 도입

### 연속형 이변량 분포의 확률
$$P(a \leq X \leq b, c \leq Y \leq d) = \int_a^b \int_c^d f(x,y) \, dy \, dx$$

### 기하학적 의미
- xy평면 위의 직사각형 $[a,b] \times [c,d]$
- 곡면 $z = f(x,y)$ 아래의 **부피**

### 밀도함수의 조건
$$\int_{-\infty}^{\infty} \int_{-\infty}^{\infty} f(x,y) \, dx \, dy = 1$$
$$f(x,y) \geq 0$$

---

## 8. 일변수 리만 적분 복습

### 정의
구간 [a,b]를 분할: $a = x_0 < x_1 < \cdots < x_n = b$

리만 합:
$$S_n = \sum_{i=1}^{n} f(x_i^*)(x_i - x_{i-1})$$

분할을 세밀하게 (mesh → 0):
$$\lim_{\text{mesh} \to 0} S_n = \int_a^b f(x) \, dx$$

---

## 9. 이변수 적분으로 확장

### 영역
$$A = [a,b] \times [c,d]$$

### 분할
- x축: $a = x_0 < x_1 < \cdots < x_n = b$
- y축: $c = y_0 < y_1 < \cdots < y_m = d$

### 리만 합 (작은 직육면체들의 합)
$$S = \sum_{i,j} f(x_i^*, y_j^*) \cdot (x_i - x_{i-1}) \cdot (y_j - y_{j-1})$$

### 누적적분 (Iterated Integral)
$$\iint_A f(x,y) \, dA = \int_a^b \left( \int_c^d f(x,y) \, dy \right) dx$$

> "y에 대해 먼저 적분하고, 그 다음 x에 대해 적분"
> 또는 순서를 바꿔도 됨 (푸비니 정리)

---

## 10. 핵심 공식 정리

| 개념 | 공식 |
|---|---|
| 곱셈공식 | $P(X,Z) = P(Z) \cdot P(X\|Z)$ |
| 반복기대값 | $E[E[g(X,Z)\|Z]] = E[g(X,Z)]$ |
| 공분산 정의 | $\text{Cov}(X,Z) = E[(X-\mu_X)(Z-\mu_Z)]$ |
| 공분산 공식 | $\text{Cov}(X,Z) = E[XZ] - \mu_X\mu_Z$ |
| 중적분 | $\iint f(x,y) \, dA$ = 부피 |

---

## 11. 이 강의의 핵심 메시지

1. **반복기대값으로 E[XZ] 계산**
   - 직접 계산하기 어려운 기대값도 조건부로 분해하면 쉬움

2. **공분산 공식**
   - $\text{Cov}(X,Z) = E[XZ] - E[X]E[Z]$
   - 계산에 매우 유용

3. **이산 → 연속 전환 준비**
   - 합(Σ) → 적분(∫)
   - 중적분 개념 도입

---

## 12. Q&A: 자주 헷갈리는 개념

### Q1. 왜 E[XZ|Z] = Z·E[X|Z] 인가?

Z=z가 주어지면 Z는 **상수** 취급이므로:
$$E[XZ|Z=z] = z \cdot E[X|Z=z]$$

확률변수로 쓰면:
$$E[XZ|Z] = Z \cdot E[X|Z]$$

### Q2. Cov(X,Z) > 0 이면 무슨 의미?

- X가 크면 Z도 크는 **경향**이 있음
- 예제에서 Cov(X,Z) = pλ > 0
- 구매자 수(X)가 많으면 총 방문객(Z)도 많음 (당연!)

### Q3. 중적분은 왜 필요한가?

연속형 이변량 분포에서:
- 동시밀도함수 f(x,y)
- 확률 계산 = 영역 위의 "부피"
- → 중적분 필요!
